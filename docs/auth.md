# Authentication (Convex Auth)

This project uses **Convex Auth** end-to-end:

- Frontend uses `@convex-dev/auth/react` and `@convex-dev/auth/nextjs`
- Backend providers are configured in `convex/auth.ts`
- Protected routes are enforced in `middleware.ts`

## Providers currently wired

From `convex/auth.ts`:

- Password (email + password)
- Google OAuth (enabled only if `GOOGLE_CLIENT_ID` + `GOOGLE_CLIENT_SECRET` exist in Convex env)
- Facebook OAuth (enabled only if `FACEBOOK_CLIENT_ID` + `FACEBOOK_CLIENT_SECRET` exist in Convex env)

If an OAuth provider is not configured, the UI still shows the button, but sign-in
will fail with a helpful message.

## Required Convex env vars

Convex Auth needs **deployment-side** environment variables (set via `npx convex env set`):

- `SITE_URL` — the Next.js site origin (e.g. `http://localhost:3000`)
- `CONVEX_SITE_URL` — the Convex “site” origin (required by `convex/auth.config.ts`)
- `JWT_PRIVATE_KEY` — generated by `npm run convex:auth:keys`
- `JWKS` — generated by `npm run convex:auth:keys`

Details: `docs/environment.md`

## How auth requests flow (important)

There are two relevant Next.js routes:

- `src/app/api/auth/route.ts`
  - Handles `auth:signIn` / `auth:signOut` actions.
  - Manages auth cookies (including `__Host-__convexAuthJWT` variants).

- `src/app/api/auth/[...auth]/route.ts`
  - Proxies `/api/auth/*` requests to the Convex deployment using `NEXT_PUBLIC_CONVEX_URL`.

## Route protection

- `middleware.ts` protects `/tasks/*` routes:
  - If not authenticated, redirects to `/login`.

Add more protected routes by expanding `createRouteMatcher([...])`.

## Where the UI uses auth

- Login: `src/app/login/page.tsx`
- Signup: `src/app/signup/page.tsx`
- Auth state hook: `src/lib/useUser.ts`
